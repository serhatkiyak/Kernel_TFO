/* TreeJS v0.2.0.build201410211002 */
!function(a){var b,c={escapeHTML:function(a){return KISSY.escapeHTML(a)},startsWith:function(a,b){return KISSY.startsWith(a,b)}},d={each:function(a,b,c){KISSY.each(a,b,c)},clone:function(a){return KISSY.clone(a)},create:Object.create||function(a){function b(){}return b.prototype=a,new b},mix:function(a,b,c,d){return KISSY.mix(a,b,c,null,d)},isPlainObject:function(a){return KISSY.isPlainObject(a)}},e={indexOf:function(a,b){return KISSY.indexOf(b,a)},inArray:function(a,b){return KISSY.inArray(b,a)},each:function(a,b,c){KISSY.each(a,b,c)},reduce:function(a,b,c){return a?KISSY.reduce(a,b,c):void 0},map:function(a,b,c){return a?KISSY.map(a,b,c):void 0}},f=document,g=function(a,b,c){a?c(KISSY,a):KISSY.use(b,c)},h={get:function(a,b){return"string"==typeof a?(b&&11==b.nodeType?b:f).getElementById(a):a},create:function(a,b){g(KISSY.DOM,"dom",function(c,d){b&&b(d.create(a))})},render:function(a,b,c,d){g(KISSY.DOM,"dom",function(e,g){var h="string"==typeof a?g.create(a):a;g["before"==c?"insertBefore":"after"==c?"insertAfter":c||"append"](h,b||f.body),d&&d(h)})},remove:function(a,b){g(KISSY.DOM,"dom",function(c,d){d.remove(a),b&&b()})},html:function(a,b){g(KISSY.DOM,"dom",function(c,d){b(d.html(a))})}},i={on:function(a,b,c,d){g(KISSY.Event,"event",function(e,f){f.on(a,b,c),d&&d()})},off:function(a,b,c,d){g(KISSY.Event,"event",function(e,f){f.detach(a,b,c),d&&d()})},delegate:function(a,b,c,d,e){g(KISSY.Event,"event",function(f,g){g.delegate(a,b,c,d),e&&e()})},undelegate:function(a,b,c,d,e){g(KISSY.Event,"event",function(f,g){g.undelegate(a,b,c,d),e&&e()})}},j={request:function(a,b,c,d,e,f){g(KISSY.IO,"ajax",function(){KISSY.IO({url:a,dataType:b,cache:!1,type:c||"get",async:null==d?!0:d,timeout:4,success:e,error:function(a,b,c){f&&f(c)}})})}},k=["debug","warn","error"],a="undefined"==typeof a?0:a,l={log:function(b,c){if(b&&c>=a&&"undefined"!=typeof console){c=k[c],console[c in console?c:"log"](b.message||b);var d=b.stack;d&&console.log(d)}}};"undefined"==typeof TreeJS&&(TreeJS=b={});var m=b.Promise=function(){function a(a){return function(){return w.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return i(a)?a:j(a)?q(a):p(a)}function f(){function a(a){b=a,j.source=a,e.reduce(h,function(b,c){v(function(){a.promiseDispatch.apply(a,c)})},void 0),h=void 0}var b,h=[],i=d.create(f.prototype),j=d.create(g.prototype);return j.promiseDispatch=function(){var a=x(arguments);h?h.push(a):v(function(){b.promiseDispatch.apply(b,a)})},j.inspect=function(){return b?b.inspect():{state:"pending"}},i.promise=j,i.resolve=function(d){b||a(c(d))},i.fulfill=function(c){b||a(p(c))},i.reject=function(c){b||a(o(c))},i}function g(a,b,c){void 0===b&&(b=function(a){return o(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var e=d.create(g.prototype);if(e.promiseDispatch=function(c,d,f){var g;try{g=a[d]?a[d].apply(e,f):b.call(e,d,f)}catch(h){g=o(h)}c&&c(g)},e.inspect=c,c){var f=c();"rejected"===f.state&&(e.exception=f.reason)}return e}function h(a,b,d){return c(a).then(b,d)}function i(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function j(a){return b(a)&&"function"==typeof a.then}function k(){y.length=0,z.length=0,A||(A=!0)}function m(a,b){A&&(z.push(a),y.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function n(a){if(A){var b=e.indexOf(z,a);-1!==b&&(z.splice(b,1),y.splice(b,1))}}function o(a){var b=g({when:function(b){return b&&n(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return m(b,a),l.log(a,2),b}function p(a){return g({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):(a[b]||l.log("The method '"+b+"' is undefined",2),a[b].apply(a,c))},apply:function(b,c){return a.apply(b,c)}},void 0,function(){return{state:"fulfilled",value:a}})}function q(a){var b=f();return v(function(){try{a.then(b.resolve,b.reject)}catch(c){b.reject(c)}}),b.promise}function r(a,b,d){return c(a).dispatch(b,d)}function s(a){return h(a,function(a){var b=0,c=f();return e.reduce(a,function(d,e,f){var g;i(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,h(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject))},void 0),0===b&&c.resolve(a),c.promise})}var t=!1;try{throw new Error}catch(u){t=!!u.stack}var v=function(){function a(){for(;b.next;){b=b.next;var a=b.task;b.task=void 0;var c=b.domain;c&&(b.domain=void 0,c.enter());try{a()}catch(e){setTimeout(function(){throw e},0)}c&&c.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0;if(v=function(a){c=c.next={task:a,domain:!1,next:null},d||(d=!0,e())},"function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=function(){e=g,f.port1.onmessage=a,a()};var g=function(){f.port2.postMessage(0)};e=function(){setTimeout(a,0),g()}}else e=function(){setTimeout(a,0)};return v}(),w=Function.call,x=a(Array.prototype.slice);c.resolve=c,c.nextTick=v,c.defer=f,c.makePromise=g,g.prototype.toString=function(){return"[object Promise]"},g.prototype.then=function(a,b){function c(b){try{return"function"==typeof a?a(b):b}catch(c){return o(c)}}function d(a){if("function"==typeof b)try{return b(a)}catch(c){return o(c)}return o(a)}var e=this,g=f(),h=!1;return v(function(){e.promiseDispatch(function(a){h||(h=!0,g.resolve(c(a)))},"when",[function(a){h||(h=!0,g.resolve(d(a)))}])}),g.promise},c.when=h,g.prototype.isPending=function(){return"pending"===this.inspect().state},g.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},g.prototype.isRejected=function(){return"rejected"===this.inspect().state};var y=[],z=[],A=!0;return c.resetUnhandledRejections=k,c.getUnhandledReasons=function(){return y.slice()},c.stopUnhandledRejectionTracking=function(){k(),A=!1},k(),c.reject=o,c.fulfill=p,c.dispatch=r,g.prototype.dispatch=function(a,b){var c=this,d=f();return v(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},g.prototype.invoke=function(a){return this.dispatch("post",[a,x(arguments,1)])},c.all=s,g.prototype.all=function(){return s(this)},c}(),n="__TreeJSAttrData__",o=function(a){var b=this[n],c=this.constructor.ATTRS||this.ATTRS;if(a){var e,f,g;b&&a in b?f=b[a]:c&&null!=(e=c[a])&&(f=d.clone(d.isPlainObject(e)?e.value:e)),e&&(g=e.getter)&&(f=g.call(this,f,a)),b=f}else b=b||d.clone(c);return b},p=function(a,b){if(a){if("object"!=typeof a){var c,e,f,g=this.constructor.ATTRS||this.ATTRS;return g&&(c=g[a])&&(e=c.setter)&&(f=e.call(this,b,a),b=void 0==f?this.get(a):f),(this[n]=this[n]||{})[a]=b,b}var h=this;d.each(a,function(a,c){p.call(h,c,a,b)})}},q=function(a,b,c){var d=typeof a;a="function"==d?a.prototype:"object"==d?a:null,a&&(a[b||"get"]=o,a[c||"set"]=p)},r="_TreeJSInit",s=function(a,b){if(a&&b){b=b instanceof Array?b:[b];var c=a[r],f={},g=f.constructor,h=a.prototype,i=a.constructor,j=a;e.each(b,function(b){if(b){var e=b[r];c&&e&&c.push.apply(c,e);var i=b.constructor;d.mix(f,(e?e[0]:b).ATTRS||i.ATTRS,!0,!0),d.mix(h||a,b.prototype||(i==g?b:i.prototype),!0,!0)}}),j=c?h.constructor=c[0]:i==g?a:i,j.ATTRS=f,q(j)}return a},t="_TreeJS_AO_",u=function(a,b,c,d){var f,g,h;return e.each(c[0],function(a){try{g=a[0].apply(a[1],d),null!=g&&(d=g instanceof Array?g:[g])}catch(b){if(b!==!1)throw b;h=!0}}),h||(g=b.apply(a,d),d.splice(0,0,g),e.each(c[1],function(a){g=a[0].apply(a[1],d),null!=g&&(d[0]=g)}),f=d[0]),f},v=function(a,b,c,d,e){var f=b[t]=b[t]||{},g=f[c];if(!g){g=f[c]=[];var h=b[c];b[c]=function(){return u(b,h,g,[].slice.call(arguments))}}var i=g[a]=g[a]||[],j=i.length;e=e||b,i[j]=["string"==typeof d?e[d]:d,e];var k={remove:function(){i.splice(j,1)}};return k},w=function(a,b,c){return v(0,this,a,b,c)},x=function(a,b,c){return v(1,this,a,b,c)},y=function(a){var b=typeof a;a="function"==b?a.prototype:"object"==b?a:null,a&&(a.before=w,a.after=x)},z=[],A="__TreeJSMod__",B=0,C={},D={add:function(a,b,c){var d=z[a]=z[a]||{};(d[b]=d[b]||[]).push(c)},invoke:function(a,b,c){var f=z[a];return f&&(b?e.each(f=f[b],c):d.each(f,function(a){e.each(a,c)})),f},registerModules:function(a,b){var c=this;d.each(b,function(b,d){b.name=c.registerModule(a,b,d)})},registerModule:function(a,b,c){return b?(c?(c=this.getModuleName(a,c),C[c]&&l.log("The TreeJS module ("+c+") is registered again.",1)):c=A+B++,C[c]=b,b.type||(b.type="js"),G.parse(a,b,c),c):void 0},getModuleName:function(a,b){var c=b.$ref,d=c||b.name||b;return d="object"==typeof c?this.registerModule(a,c):d.indexOf(":")<0?a+":"+d:d,c&&(b.name=d),d},defineModule:function(a,b){var c=C[a];if(!c)throw new Error("The TreeJS module ("+a+") is not registered.");c.content=b},getModule:function(a){var b=a.name||a,c=C[b];if(!c){var d="Can not find TreeJS module ("+b+")";throw l.log(d,2),new Error(d)}return c}};b.config=function(a,b){D.registerModules(a,b)};var E={},F=function(a,b,c){c=c||{},e.each(E[b],function(b){c[b]||(c[b]=1,a.push(b),F(a,b,c))})},G={parse:function(a,b,c){var d=this.add(c);D.invoke(0,b.type,function(e){e.parse(d,a,b,c)})},parseCfg:function(a,b,c){var f=c instanceof Array?e:d,g=this;return f.each(c,function(c){c&&(c.$ref?a.push(D.getModuleName(b,c)):"object"==typeof c&&g.parseCfg(a,b,c))}),a},add:function(a,b){var c=E[a]=E[a]||[a];return c&&b&&c.push.apply(c,b),c},get:function(a){var b=[];return F(b,a),E[a]=b}},H={parse:function(a,b,c){var d=c.module;d&&a.push(c.module=D.getModuleName(b,d))}};D.add(0,"html",H),D.add(0,"js",H);var I={},J={},K={load:function(a){if(a){a=D.getModule(a);var b=a.name,c=I[b],d=!0;if(!c){var f=[];e.each(G.get(b),function(a){var b=J[a];if(!b){var e,g=D.getModule(a),h=g.def,i=!0;h?(e=h.type||g.type,l.log("Load module '"+a+"' by "+e,0),D.invoke(1,e,function(c){b=c.load(g),b.then(function(b){null!=b&&D.defineModule(a,O.compile(g,b))})})||(c=m.reject("Can not load module ("+a+") for invalid module definition type: "+e)),h.cache===!1&&(i=d=!1)):b=m(g),i&&(J[a]=b)}f.push(b)}),f.length>1?(c=m.all(f),c.then(function(){D.defineModule(b,O.crossCompile(a,D.getModule(b).content))})):c=f[0],d&&(I[b]=c),D.invoke(1,null,function(a){a.batchLoad&&a.batchLoad()})}return c}}},L=/^https?\:\/\/(.+?)\//,M=location.host;ajaxLoader={load:function(a){var b=m.defer(),c=a.def,d=c.url;return j.request(d,this.getIOType(d),c.method,c.async,function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},getIOType:function(a){return this.getHost(a)==M?"json":"jsonp"},getHost:function(a){var b;return a&&(b=a.match(L))?b[1]:M}},D.add(1,"ajax",ajaxLoader);var N={load:function(a){var b,c=m.defer(),d=a.def.name;return d&&(b=h.get(d))?h.html(b,function(a){c.resolve(a)}):c.reject("The DOM node '"+d+"' is not found."),c.promise}};D.add(1,"dom",N);var O={compile:function(a,b){return l.log("Compile module '"+a.name+"'",0),D.invoke(2,a.type,function(c){c.compile&&(b=c.compile(a,b))}),b},crossCompile:function(a,b){return D.invoke(2,a.type,function(c){c.crossCompile&&(b=c.crossCompile(a,b))}),b}},P={compile:function(a,b){if(b&&((a.attr||b.ATTRS)&&q(b),"function"==typeof b)){var c=function(){},d=c.prototype=b.prototype;d.constructor=b,c[r]=[b],b=c}return b}};D.add(2,"js",P);var Q=1,R="_TreeJS_HTML_",S=R+"Id",T=R+"Rendered",U=R+"Nest",V=function(a){var b=[],d=a.constructor,f=a.set(S,{}),g=a.get();return e.each(d.tpl,function(a,d){var e=a;if("string"!=typeof a){var h=a[0];1===h?e=f[a[1]]=R+Q++:(a=g[h],"function"==typeof a&&(a=a(g)),e=null==a?"":c.escapeHTML(a))}b[d]=e}),b.join("")},W=function(a,b){var c=a.get(S);d.each(a.constructor.renderings,function(a){e.each(a,function(a){var d=h.get(c[a],b);d&&"false"==d.getAttribute("node-rendering")&&h.remove(d)})})};bindHTMLListener=function(a){var b=a.constructor;d.each(b.ons,function(b,c){e.each(b,function(b){i.on(h.get(a.get(S)[b[0]]),b[1],function(b){a[c](b)})})}),d.each(b.delegates,function(b,c){e.each(b,function(b){i.delegate(h.get(a.get(S)[b[0]]),b[1],b[2],function(b){a[c](b)})})})},nestHTML=function(a,b,c){if(a){var d=[a,b,c],e=this.get(U)||[];e.push(d),this.set(U,e),this.isRendered()&&this.renderHTMLNested.apply(this,d)}},renderHTMLNested=function(a,b,c,d){var e,f=this.getNode(b,d);if(f)e=a.render(f,c);else{var g="Can not render html module for non-existed node (node-id: "+b+")";l.log(g,2),e=m.reject(g)}return e},renderHTML=function(a,b){var c=this.get(T),f=this;if(!c){var g=m.defer();c=this.set(T,g.promise),h.create(V(this),function(i){var j=i,k=f.get(U);if(k){j=document.createDocumentFragment(),j.appendChild(i);var l=[c];e.each(k,function(a){l.push(renderHTMLNested.call(f,a[0],a[1],a[2],j))}),c=m.all(l)}W(f,j),d.each(f.constructor.ids,function(a,b){var c=f.get(S),d=c[b]=h.get(c[b],j);d&&(d.id=a)}),h.render(j,a,b,function(a){a&&bindHTMLListener(f),g.resolve(f)})})}return c.then(function(){f.ready(f)}),c},isHTMLRendered=function(){var a=this.get(T);return a&&!a.isPending()},getHTMLNode=function(a,b){var c=this,d=e.map(c.constructor.nodes[a],function(a){return h.get(c.get(S)[a],b)});return!d||d.length>1?d:d[0]},HTML_COMMENT_PATTERN=/(\<\!--(?!<!)[^\[>].*?--\>)/g,PARAM_LEFT_B_PATTERN=/\<%/g,PARAM_RIGHT_B_PATTERN=/%\>/g,PROP_VALUE_LT_B_PATTERN=/(=\s*["'][^"']*?)\>(.*?["'])/g,PROP_VALUE_LT_A_PATTERN=/\u0017/g,HTML_NODE_PATTERN=/(\<[^\/]([^\>]+)\>)/g,TREEJS_ON_EVENT_PATTERN=/\s+on-(.+?)\s*=\s*["'](.+?)["']/gi,TREEJS_DELEGATE_EVENT_PATTERN=/\s+delegate-(.+?)\s*=\s*["'](.+?)["']/gi,TREEJS_RENDERING_FLAG_PATTERN=/\s+node-rendering\s*=\s*["']\u000E\s*(.+?)\s*\u000F["']/i,TREEJS_NODE_ID_PATTERN=/\s+node-id\s*=\s*["'](.*?)["']/i,HTML_NODE_ID_PATTERN=/\s+id\s*=\s*["'](.*?)["']/i,PARAM_PATTERN=/\u000E\s*(.+?)\s*\u000F/g,htmlCompiler={compile:function(a,b){var c="string"==typeof b,d=c?function(){}:b,f=d.prototype,g=d.tpl=d.tpl||[],h=d.nodes=d.nodes||{},i=d.ons=d.ons||{},j=d.delegates=d.delegates||{},k=d.renderings=d.renderings||{},l=d.ids=d.ids||{};return q(d),y(d),f.render=renderHTML,f.isRendered=isHTMLRendered,f.getNode=getHTMLNode,f.mixin=nestHTML,f.ready=function(){},c&&(b=b||"",e.each(b.split(HTML_COMMENT_PATTERN),function(a){if(a)if("<!--"==a.substring(0,4))g.push(a);else{a=a.replace(PARAM_LEFT_B_PATTERN,"").replace(PARAM_RIGHT_B_PATTERN,"").replace(PROP_VALUE_LT_B_PATTERN,"$1$2").replace(HTML_NODE_PATTERN,function(a){a=a.replace(PROP_VALUE_LT_A_PATTERN,">");for(var b,c,d,g=Q++;b=TREEJS_ON_EVENT_PATTERN.exec(a);)(d=b[2])&&(f[d]=function(){},(i[d]=i[d]||[]).push([g,b[1]]));for(;b=TREEJS_DELEGATE_EVENT_PATTERN.exec(a);)(d=b[2])&&(c=d.split(","),d=c[0],f[d]=function(){},(j[d]=j[d]||[]).push([g,b[1],c[1]]));return(b=a.match(TREEJS_RENDERING_FLAG_PATTERN))&&(d=b[1],c=k[d]=k[d]=[],c.push(g)),(b=a.match(TREEJS_NODE_ID_PATTERN))&&(d=b[1],e.each(d.split(" "),function(a){(h[a]=h[a]||[]).push(g)})),d&&(a=a.replace(HTML_NODE_ID_PATTERN,function(a,b){return l[g]=b,""}),g=' id="'+g+'"',b=a.length,a="/"==a.charAt(b-2)?a.substring(0,b-2)+g+"/>":a.substring(0,b-1)+g+">"),a});for(var b,c=0;matched=PARAM_PATTERN.exec(a);)idx=matched.index,(b=a.substring(c,idx))&&g.push(b),(b=matched[1])&&(""==b.charAt(0)?(b=b.split(""),b[0]=1):b=[b],g.push(b)),c=idx+matched[0].length;g.push(a.substring(c))}})),d}},D.add(2,"html",htmlCompiler);var X="_TreeJS_CSS_";TREEJS_CSS_NEST=X+"Nest",TREEJS_CSS_RENDERED=X+"Rendered",nestCSS=function(a,b,c){b&&a[TREEJS_CSS_NEST].push([b,c||"after"])},renderCSS=function(a,b){var c=this[TREEJS_CSS_RENDERED];if(!c){var d=this;c=d[TREEJS_CSS_RENDERED]=m.defer(),h.create("<style>"+d.constructor.tpl+"</style>",function(f){var g=f,i=d[TREEJS_CSS_NEST];i.length&&(g=document.createDocumentFragment(),g.appendChild(f)),e.each(i,function(a){var b=a[0];b.render.call(b,f,a[1])}),h.render(g,a||"head",b,function(a){a?c.resolve(d):c.reject("Can not render css module")})})}return c.promise},cssCompiler={compile:function(a,b){var c;return b&&("string"==typeof b?(c=function(){this[TREEJS_CSS_NEST]=[]},c.tpl=b):c=b,c.prototype.render=renderCSS),c}},D.add(2,"css",cssCompiler);var Y={},Z={},$={instantiate:function(a,b){if(a){var d;a=D.getModule(a);var e=a.name,f="prototype"==a.scope;if(!f&&e in Y)d=Y[e];else{if(0==Z[e]){var g="Can not instantiate module for recursive reference: "+(c.startsWith(e,A)?"undefined"==typeof JSON?"":JSON.stringify(a):e);throw l.log(g,2),new Error(g)}l.log("Instantiate module '"+e+"'",0);var h=a.type;if(d=a.content,!D.invoke(3,h,function(c){Z[e]=f,d=c.instantiate(e,a,a.content,b,d)}))throw new Error("Can not instantiate module ("+e+") for invalid module type: "+h)}return d}},instantiateCfg:function(a){var b,c=this;return a instanceof Array?(b=[],e.each(a,function(a){b.push(c.instantiateCfg(a))})):"object"==typeof a?a.$ref?b=this.instantiate(a):(b={},d.each(a,function(a,d){b[d]=c.instantiateCfg(a)})):b=a,b},cacheInstance:function(a,b,c){delete Z[a],"prototype"!=b.scope&&(Y[a]=c)}},_={parse:function(a,b,c){G.parseCfg(a,b,c.constructor),G.parseCfg(a,b,c.attr);var e=c.implMethod;d.each(e,function(c,d){a.push(e[d]=D.getModuleName(b,c))})},instantiate:function(a,b,c,e){var f,g=b.constructor;if("function"==typeof g)g=e||[];else{if(g=null==g?e:$.instantiateCfg(g),g&&(g instanceof Array||(g=[g]),e))for(var h,i=Math.max(g.length,e.length);--i>-1;)h=e[i],g[i]=null==h?g[i]:h;g=g||[]}return f=this.getInstance(a,b,c,g),d.each(b.implMethod,function(a,b){f[b]=function(){return hb.instantiate(a,arguments)}}),d.each(b.attr,function(a,b){f.set(b,$.instantiateCfg(a))}),f},getInstance:function(a,b,c,d){var f,g,h=c,i=b.module;if(i){if(h=$.instantiate(i),!h)throw new Error("The TreeJS module ("+i+") is undefined");if(f=b.refMethod)h=[f,h];else if(f=b.factoryMethod){if(!(g=h[f]))throw new Error("The factoryMethod '"+f+"' is undefined");h=g.apply(h,d)}}else{var j=typeof c,k="function"==j;if(k||"object"==j)if(f=b.factoryMethod){if(!(i=c[f]||c[r][0][f]))throw new Error("The factoryMethod '"+f+"' is undefined");h=i.apply(c,d)}else k&&(h=new c,e.each(c[r],function(a){var b=a.apply(h,d);"object"==typeof b&&null!=b&&(h=b)}))}return $.cacheInstance(a,b,h),h}};D.add(0,"js",_),D.add(3,"js",_);var ab={parse:function(a,b,c){G.parseCfg(a,b,c.attr)},instantiate:function(a,b,c,e){var f=this.getInstance(a,b,c,e);return d.each(b.attr,function(a,b){f.set(b,$.instantiateCfg(a))}),f},getInstance:function(a,b,c,d){var e,f=b.module;if(f)e=$.instantiate(f);else{if(!c){var g="The TreeJS module ("+a+") is undefined";throw l.log(g,2),new Error(g)}e=new c(d),e.constructor=c}return $.cacheInstance(a,b,e),e}};D.add(0,"html",ab),D.add(3,"html",ab);var bb={instantiate:function(a,b,c){var d;return c&&(d=new c),$.cacheInstance(a,b,d),d}};D.add(3,"css",bb);var cb={parse:function(a,b,c){var d=c.mixin;d&&e.each(c.mixin=d instanceof Array?d:[d],function(c){a.push(c.module=D.getModuleName(b,c.module))})},instantiate:function(a,b,c,d,f){return e.each(b.mixin,function(b){var c=b.module;l.log("Mix '"+c+"' to '"+a+"'",0),nestCSS(f,$.instantiate(c),b.position)}),f}};D.add(0,"css",cb),D.add(3,"css",cb);var db={parse:function(a,b,c){var d=c.mixin;d&&e.each(c.mixin=d instanceof Array?d:[d],function(c){a.push(c.module=D.getModuleName(b,c.module))})},instantiate:function(a,b,c,d,f){return e.each(b.mixin,function(b){var c=b.module;l.log("Mix '"+c+"' to '"+a+"'",0),f.mixin($.instantiate(c),b.node,b.position)}),f}};D.add(0,"html",db),D.add(3,"html",db);var eb={parse:function(a,b,c){var d=c.mixin;d&&(c.mixin=e.map(d instanceof Array?d:[d],function(c){return a.push(c=D.getModuleName(b,c)),c}))},crossCompile:function(a,b){if(b){var c=a.name,d=e.map(a.mixin,function(a){return l.log("Mix '"+a+"' to '"+c+"'",0),D.getModule(a).content});return s(b,d),b}},instantiate:function(a,b,c,d,f){if(!c){var g=e.map(b.mixin,function(b){return l.log("Mix '"+b+"' to '"+a+"'",0),$.instantiate(b)});s(f,g)}return f}};D.add(0,"js",eb),D.add(2,"js",eb),D.add(3,"js",eb);var fb={},gb={parse:function(a,b,c,e){d.each(c.intercept,function(a,c){G.add(c=D.getModuleName(b,c),[e]);var d=fb[c]=fb[c]||[];d.push([e,a])})},compile:function(a,b){return(a.intercept||fb[a.name])&&y(b),b},instantiate:function(a,b,c,f,g){return g&&e.each(fb[a],function(b){var c=b[0],e=$.instantiate(c);d.each(b[1],function(b,f){d.each(b,function(b,d){l.log("Advice '"+c+"."+b+"()' "+d+" '"+a+"."+f+"()'",0),g[d](f,b,e)})})}),g}};D.add(0,"js",gb),D.add(2,"js",gb),D.add(2,"html",gb),D.add(3,"js",gb),D.add(3,"html",gb);var hb={instantiate:function(a,b){var c=$.instantiate(a,b);return c},get:function(a){var b=D.getModule(a),c=[].slice.call(arguments,1),d=this,e=K.load(b);return e.then(function(){return d.instantiate(b,c)},function(b){throw l.log("Can not get TreeJS module ("+a+").",2),l.log(b,2),new Error(b)})}};b.get=function(){return hb.get.apply(hb,arguments)};var ib=/.css\s*$/,jb=[],kb={},lb={load:function(a){var c=a.def.name;jb.push(c);var d=kb[c]=kb[c]||b.Promise.defer();return d.promise},batchLoad:function(){var a=jb,b=kb;KISSY.use(a,{success:function(){for(var c,d=arguments,e=a.length,f=d.length-1,g=e!=f;--e>-1;)c=a[e],b[c].resolve(g&&ib.test(c)?void 0:d[f--])},error:function(a){var c=a.name;b[c].reject("Load KISSY module ("+c+") failed.")}}),jb=[],kb={}}};D.add(1,"kissy",lb)}(2);/*! umpp 2014-08-25 */
KISSY.add("tbc/umpp/1.4.20/mods/messenger",function(a){function b(a,b){return u.push([a,b])-1}function c(a){return u[a]=null}function d(b,c,d){var e={type:b,content:c},f=d;if(a.isString(d)?(f=m.get("#"+d),d=f.contentWindow):d.contentWindow&&(d=d.contentWindow),i())try{return d.KISSY.TBC.Messenger.fire(b,c)}catch(g){}o?j&&(j.callSWF?j.callSWF("send",[e,h(f)]):j.send(e,h(f))):d.postMessage(n.stringify(e),"*")}function e(b,c){a.each(u,function(a){a&&a[0]===b&&a[1](c)})}function f(b,c){var d,e=(o?"parentFlash="+x+"&childFlash=_MessengerChildFlash_"+a.now()+"&":"")+"domain=taobao.org";a.isString(b)?(d=b,b={}):d=b.src,b.src=d+(d.indexOf("?")>-1?"&":"?")+e;var f=m.create("<iframe>",b);return f.setAttribute("width",1),f.setAttribute("height",1),f.style.position="absolute",m.get(c||"body").appendChild(f)}function g(a,b){v?f(a,b):w.push([a,b])}function h(a){var b=a.src,c=/childFlash=([^&]+)/;if(b){var d=b.match(c);if(d&&d[1])return d[1];throw"iframe has no flashName param"}}function i(){return!1}var j,k=window,l=a.namespace("TBC.Messenger"),m=a.DOM,n=(a.Event,a.UA,a.JSON),o=(document.domain,"undefined"==typeof postMessage||!k.addEventListener),p=-1===location.host.indexOf("daily")&&-1===location.host.indexOf("net"),q=location.protocol<"https",r=q?"//g."+(p?"tbcdn.cn":"assets.daily.taobao.net"):"//"+(p?"s.tbcdn.cn/g":"assets.daily.taobao.net"),s="1.4.20",t=parseFloat(s)?r+"/tbc/umpp/"+s+"/flash-post-message.swf":"flash-post-message.swf",u=[],v=!o,w=[],x="_MessengerFlash_"+a.now();if(!i()||o)if(o){var y=!(a.version<=1.2||a.version>=1.4);a.use(y?"swf":"flash",function(a,b){window._Messenger_Flash_PostMessage=function(a,b){var c=b.type,d=b.msg;if("swfReady"===c){v=!0;for(var g;g=w.pop();)f.apply(null,g)}else"message"==c&&d&&e(d.type,d.content)};var c={src:t,attrs:{width:1,height:1,style:"position:absolute;top:0",id:"umpp-message-id",name:"umpp-message-name"},params:{flashVars:{jsentry:"_Messenger_Flash_PostMessage",swfid:"J_MessengerFlashPostMessage",name:x},allowscriptaccess:"always"}};b&&y?j=new b(c):a.Flash&&a.Flash.add&&a.Flash.add("#J_FlashPostMessageContainer",c,function(a){j=a.swf})})}else k.addEventListener("message",function(b){var c=b.data;if(c&&a.isString(c))try{var d=n.parse(c);e(d.type,d.content)}catch(f){}},!1);else v=!0;return a.mix(l,{register:b,unregister:c,send:d,createIframe:g,fire:e,flashName:x})},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.20/mods/getNick",function(a){var b=a.namespace("TBC.umpp");return b.getNick=function(b){var c=a.Cookie.get("_nk_")||a.Cookie.get("lgc");return b&&c?encodeURIComponent(unescape(c.replace(/\\u/g,"%u"))):c}},{requires:["cookie"]}),KISSY.add("tbc/umpp/1.4.20/mods/trinity",function(a){function b(a,b,c){this.nick=a||"umpp-guest",this.swfurl=b,this.evs=c,this._init()}var c=a.DOM,d=(a.JSON,a.namespace("TBC.umpp")),e="UM_",f=window,g="J_UmppUserContainer",h="_umpp_trinity_",i=b.prototype;return i._init=function(){var b=this,d={src:b.swfurl,attrs:{width:1,height:1,id:"umpp-trinity-id",name:"umpp-trinity-name"},params:{flashVars:{jsentry:h,swfid:e+b.nick+a.now(),group:b.nick},allowscriptaccess:"always"}};f[h]=function(a,c){var d=c.type,e=c.data,f=b.evs,g=f[d];g&&g.call(b,"message"===d?e:null)};var i=!(a.version<=1.2||a.version>=1.4);a.use(i?"swf":"flash",function(a,e){i&&e?b.swf=new e(d):a.Flash&&a.Flash.add&&(c.get("#"+g)||document.body.appendChild(c.create('<div id="'+g+'" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px"></div>')),a.Flash.add("#"+g,d,function(a){b.swf=a.swf}))})},i.fire=function(a,b){return this.swf.callSWF?this.swf.callSWF("fire",[a,b]):(this.swf.fire(a,b),void 0)},i.destroy=function(){var a=this;try{a.swf.destroy?a.swf.destroy():c.remove("#"+g),delete f[h]}catch(b){}},d.Trinity=b},{requires:["dom","json"]}),KISSY.add("tbc/umpp/1.4.20/mods/initGuest",function(a){function b(b,f,g){return e._guestTimer=setTimeout(function(){a.getScript(parseFloat(c)?f+"/tbc/umpp/"+c+"/guest-min.js":"guest.js",function(){parseFloat(a.version,10)>1.1&&a.use(parseFloat(c)?"tbc/umpp/"+c+"/guest":"tbc/umpp/guest")})},d),a.mix(e,{isOnline:b,cdnPath:f,Trinity:g}),e}var c="1.4.20",d=18e4,e=a.namespace("TBC.umpp");return a.mix(e,{register:function(){},send:function(){},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),this._guestTimer&&(clearTimeout(this._guestTimer),this._guestTimer=null)}}),e.initGuest=b}),KISSY.add("tbc/umpp/1.4.20/mods/initUser",function(a){function b(a){n.get("#"+p)||o.createIframe({src:a,id:p,frameborder:0,scrolling:"no"})}function c(b){a.isArray(b)&&b.length&&a.each(b,function(a){"1063"==a.t1&&t.trinity.fire({content:[a],identity:[t.nick,a.t1,"1"].join("-")})})}function d(){o.register("umppready",function(){l=!0,f("master"),f("join")}),o.register("umppdata",function(a){t.notify(a,!0),c(a)})}function e(b,c){if(!c)return!1;var d=c.body,e=d.content;if(a.isObject(d))if("-"===d.identity)a.each(e,function(b){a.each(t._Events,function(a){a&&b.t1==a[0]&&a[1](b)})});else if(q===d.type)if(j){var g=e[0],h=e[1];"umpp-store-get"===g?t.getItem(h,function(a){b.fire.call(b,{type:q,content:[h,a]},c.from)}):"umpp-store-remove"===g?t.removeItem.call(t,h):"umpp-store-set"===g?t.setItem.apply(t,h):t.send(g,h)}else{var e=d.content;o.fire("umpp-store-get-"+e[0],e[1])}else if(r===d.type){if(!d.includeSelf&&c.from===c.to)return!1;f("message",d.content)}}function f(b,c){a.each(t._SwfEvents,function(a){a&&b===a[0]&&(a[1](c),"message"!==b&&(a[0]=b+"_ed"))})}function g(a){b("//mpp."+(a?"taobao.com":"daily.taobao.net:8080")+"/ajaxconn2.html?appId="+s),l&&f("master")}function h(c,h,i,m){t.trinity=new c(h,i,{master:function(){j=!0,d(),new a.IO({url:"//allot.mpp."+(m?"taobao.com":"daily.taobao.net")+"/allot.do?appId="+s,dataType:"jsonp",timeout:3,success:function(a){if(a&&0==a.code){var c=a.tn?a[a.tn]:a.token;c&&(c="&"+(a.tn?a.tn:"token")+"="+c),b("//"+a.host+"/ajaxconn2.html?appId="+s+c),l&&f("master")}else a&&1111==a.status&&g(m)},error:function(){g(m)}})},join:function(){k=!0,(j&&l||!j)&&f("join")},message:function(a){e(this,a)}})}function i(a,b,c,d,e){var f=parseFloat(m)?b+"/tbc/umpp/1.4.2/trinity.swf":"trinity.swf";return t.nick=c,h(d,c,f,a),t.on("join",function(){new e({mc:t})}),t}var j,k,l,m="1.4.20",n=a.DOM,o=a.TBC.Messenger,p="J_Um_Iframe",q="_trinity_notify_private",r="_trinity_notify_public",s=-1===location.host.indexOf("meeting.wangwang")?1064:1065,t=a.namespace("TBC.umpp");return a.mix(t,{_Events:[],_SwfEvents:[],_StoreCache:{},_storeData:function(a,b){j&&(this._StoreCache[a]=b)},_removeData:function(a){j&&this._StoreCache[a]&&delete this._StoreCache[a]},on:function(a,b){return(j&&l||!j&&k)&&("master"===a&&j||"join"===a&&k)?(b(),!0):this._SwfEvents.push([a,b])-1},off:function(b){return a.isNumber(b)?this._SwfEvents[b]=null:void 0},register:function(a,b,c){var d=this,e=function(e,f){b(e,f),c?d._storeData(a,e):d.removeItem(a)};return d.getItem(a,function(a){a&&e(a,!0)}),d._Events.push([a,e])-1},unregister:function(a){return this._Events[a]=null},send:function(a,b){return j?o.send.call(null,a,b,p):(this.trinity&&this.trinity.fire({type:q,content:[a,b]},"_"+this.nick),void 0)},notify:function(a,b){return this.trinity.fire({type:r,content:a,includeSelf:b,identity:"-"})},setItem:function(a,b){var c=this;c.on("join",function(){c._storeData(a,b),c.send("umpp-store-set",[a,b])})},getItem:function(a,b){var c=this,d=this._StoreCache[a];j&&d?b(d):c.on("join",function(){var d=o.register("umpp-store-get-"+a,function(e){o.unregister(d),c._storeData(a,e),b(e)});c.send("umpp-store-get",a)})},removeItem:function(a){var b=this;b.on("join",function(){b._removeData(a),b.send("umpp-store-remove",a)})},clear:function(a){return this.send("clearTMsg",a)},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),n.remove("#"+p),j=void 0,k=void 0,l=void 0,this._StoreCache={}}}),t.initUser=i},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.20/mods/monitorevent",function(a,b){function c(b){this.cfg=a.merge({delay:2e4},b||{}),this.status=1,this._init()}return a.mix(c.prototype,{get:function(a){return this.cfg[a]},set:function(a,b){this.cfg[a]=b},_init:function(){var b=window.g_config;return b?!b.appId||1!=b.appId&&1009!=b.appId?!1:(this.itemId=b.itemId,this.itemId?(this.activeTime=a.now(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,1,this.activeTime].join(",")),this.timer=null,this._bindEvent(),this._addTimer(),this._registerUmppEvent(),void 0):!1):!1},_bindEvent:function(){var a=this;b.on(window,"focus",function(){a._active.call(a),a._focus.call(a)}),b.on(window,"blur",function(){a._active.call(a),a._blur.call(a,!0)}),b.on(window,"mousemove scroll",function(){a._active.call(a)}),b.on(window,"beforeunload",function(){a._close.call(this)})},_registerUmppEvent:function(){var a=this,b=a.cfg.mc;b.register("monitor-start",function(){a.start.call(a)}),b.register("monitor-focustime",function(b){a.set.call(a,"delay",1e3*b.focustime)})},_focus:function(){this.set("focusbluring",!1),this.status&&(this._removeTimer(),this.timer||this._addTimer(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,2,a.now()].join(",")),console.log("focus"))},_blur:function(b){this.set("focusbluring",!1),this.status&&(b&&this._removeTimer(),console.log("blur"),this.cfg.mc.send("umpp-monitor-event",[this.itemId,3,a.now()].join(",")))},_active:function(){this.activeTime=a.now()},_close:function(){console.log("close"),this.status&&this.cfg.mc.send("umpp-monitor-event",[this.itemId,4,a.now()].join(","))},_addTimer:function(){var b=this;b.timer=setTimeout(function(){var c=a.now();c-b.activeTime>b.cfg.delay&&!b.get("focusbluring")&&(b._blur(),b.set("focusbluring",!0),console.log("focus to blur")),b.timer=setTimeout(arguments.callee,b.cfg.delay)},b.cfg.delay)},_removeTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}),c},{requires:["event"]}),KISSY.add("tbc/umpp/1.4.20/index",function(a,b,c,d,e,f,g,h){function i(){var b,c=a.Cookie,d=-1===location.host.indexOf("daily"),e=c.get("_l_g_")||c.get("lgc"),f=location.protocol<"https",g=f?"//g."+(d?"tbcdn.cn":"assets.daily.taobao.net"):"//"+(d?"s.tbcdn.cn/g":"assets.daily.taobao.net"),i=j._Events,k=j._SwfEvents;return b=e?j.initUser(d,g,j.getNick(!0),j.Trinity,h):j.initGuest(d,g,j.Trinity),i&&a.mix(b,{_Events:i}),k&&a.mix(b,{_SwfEvents:k}),a.mix(j,b)}a.version>=1.4&&a.config({modules:{ajax:{alias:["io"]},flash:{alias:["gallery/flash/1.0/"]}}});var j=a.namespace("TBC.umpp");return j.init=i,i()},{requires:["core","tbc/umpp/1.4.20/mods/messenger","tbc/umpp/1.4.20/mods/getNick","tbc/umpp/1.4.20/mods/trinity","tbc/umpp/1.4.20/mods/initGuest","tbc/umpp/1.4.20/mods/initUser","tbc/umpp/1.4.20/mods/monitorevent"]});